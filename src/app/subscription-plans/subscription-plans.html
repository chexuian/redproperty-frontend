<div class="pricing-table-container">

  @if (plans.length > 0) {
    <div class="pricing-grid">

      <div class="feature-name-column grid-header-cell">
          Features
      </div>

      @for (plan of plans; track plan.id) {
          <div class="pricing-card grid-header-cell" 
              [class.best-value]="plan.tier === 'PREMIUM'"> 
              
              @if (plan.tier === 'PREMIUM') {
                  <div class="ribbon">⭐ Best Value</div>
              }

              <div class="card-header">
                  <h2 class="plan-name">{{ plan.name }}</h2>
                  <p class="plan-price">
                      ${{ plan.price | number:'1.2-2' }}
                      <span class="price-duration">/ {{ plan.duration_days }} days</span>
                  </p>
                  <button class="cta-button">
                      Select {{ plan.name }}
                  </button>
              </div>
          </div>
      }

      @for (masterFeature of allUniqueFeatures; track masterFeature.name) {
          <div class="feature-row-name">
              {{ masterFeature.name }}
              <span class="feature-description-text">{{ masterFeature.description }}</span>
          </div>

          @for (plan of plans; track plan.id) {
              @if (planHasFeature(plan, masterFeature.name); as planFeature) {
                  <div class="feature-row available">
                      @if (planFeature.unlimited) {
                          <span class="icon checkmark">✅</span> Unlimited
                      } @else if (planFeature.limit !== null) {
                          <span class="icon count">{{ planFeature.limit }}</span> Items
                      }
                  </div>
              } @else {
                  <div class="feature-row unavailable">
                      <span class="icon cross">❌</span> Not Included
                  </div>
              }
          }
      }
    </div>
  } @else {
    <div class="loading-message">
        <p>Loading subscription plans...</p>
    </div>
  }

</div>